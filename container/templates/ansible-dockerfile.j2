FROM centos:7

# Install:
#   docker (to use as client)
#   ansible + some deps
RUN yum update -y                 && \
    yum install -y epel-release   && \
    yum install -y docker-latest && \
    yum install -y "@Development Tools" git python-setuptools python-devel python-pip rsync libffi-devel openssl-devel && \
    yum clean all && \
    `# Install ruamel.yaml for Galaxy roles and others as Ansible requirements` \
    pip install -q --no-cache-dir paramiko PyYAML Jinja2 httplib2 six 'ansible<2.2.0' ruamel.yaml epdb && \
    `# Installing the latest from Ansible to get synchronize module support.` \
    pip install -q --no-cache-dir -e git+https://github.com/ansible/ansible.git@devel#egg=ansible && \
    pip install -q --no-cache-dir -U setuptools && \
    mkdir -p /etc/ansible/roles && \
    mkdir -p /etc/ansible/strategy_plugins && \
    `# In 9deb3eb we moved to /usr/bin/ansible-playbook` \
    `# Let's ease the transition on people using <9deb3eb code` \
    `# by symlinking to the new place` \
    ln -s /usr/bin/ansible-playbook /usr/local/bin/ansible-playbook

ADD builder.sh /usr/local/bin/builder.sh
ADD ac_galaxy.py /usr/local/bin/ac_galaxy.py
ADD wait_on_host.py /usr/local/bin/wait_on_host.py
ADD ansible-container-inventory.py /etc/ansible/ansible-container-inventory.py
# ADD ansible.cfg /etc/ansible/ansible.cfg
ADD docker-strategy.py /etc/ansible/strategy_plugins/linear.py

